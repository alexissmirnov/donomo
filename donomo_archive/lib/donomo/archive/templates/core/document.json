{% load page_url %}
{% spaceless %}
{% autoescape off %}
{
    "title" : "{{document.title|escapejs}}",
    "tags_string"  : "{% for tag in document.tag_set.all %}{{tag.label|escapejs}}{% if not forloop.last %}, {% endif %}{% endfor %}",
    "tags"  : [{% for tag in document.tag_set.all %}"{{tag.label|escapejs}}"{% if not forloop.last %}, {% endif %}{% endfor %}],
	"page_count" : "{{document.bindings.count}}",
	"title_page_img_url" : "{% for binding in document.bindings.all %}{% if forloop.first %}{% page_url binding viewtype as page %}{{page}}{% endif %}{% endfor %}",
    "document_url" : "{{document.get_absolute_url|escapejs}}",
    "pages" : [{% for binding in document.bindings.all %}
        {   "page_index" : {{binding.page_number}},
            {% page_url binding viewtype as page_image %}
            "page_image_url" : "{{page_image|escapejs}}",
            "page_url" : "{{binding.page.get_absolute_url|escapejs}}"
        }{% if not forloop.last %},{% endif %}{% endfor %}]
}
{% endautoescape %}
{% endspaceless %}
