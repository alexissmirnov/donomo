{% load page_url %}
{% autoescape off %}
{% spaceless %}
{
	"documents" : [
		{% for document, pages in documents.items %}
		{ 
			"document_url" : "{{document.get_absolute_url}}",
			"page_count" : "{{document.bindings.count}}",
			"title_page_img_url" : "{% for binding in document.bindings.all %}{% if forloop.first %}{% page_url binding viewtype as page %}{{page}}{% endif %}{% endfor %}",
	    	"title" : "{{document.title|escapejs}}",
	    	"tags"  : [{% for tag in document.tag_set.all %}"{{tag.label|escapejs}}"{% if not forloop.last %}, {% endif %}{% endfor %}],
	    	"page_count" : "{{pages|length}}",
	    	"pages" : [{% for binding in pages %}
		        {   "page_index" : {{binding.page_number}},
		            {% page_url binding viewtype as page_image %}
		            "page_image_url" : "{{page_image|escapejs}}",
		            "page_url" : "{{binding.page.get_absolute_url|escapejs}}"
		        }{% if not forloop.last %},{% endif %}{% endfor %}]
		}{% if not forloop.last %},{% endif %}
		{% endfor %}
	]
}
{% endspaceless %}
{% endautoescape %}



