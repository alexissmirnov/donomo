<!-- YUI_include fonts grids slider logger container layout selector cookie json event element datasource button utilities animation -->
<script src="{{MEDIA_URL}}jstemplate/util.js"></script>
<script src="{{MEDIA_URL}}jstemplate/jsevalcontext.js"></script>
<script src="{{MEDIA_URL}}jstemplate/jstemplate.js"></script>
<link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}ui/docpanel/assets/docpanel-core.css" >
<script src="{{MEDIA_URL}}ui/docpanel/docpanel.js"></script>
<script src="{{MEDIA_URL}}ui/docpanel/tageditor.js"></script>
<script src="{{MEDIA_URL}}ui/tags/tagpanel.js"></script>

<script>
	/*
	 * Panel initialization.
	 * First, initialize the panel module. Then subscribe it to the changes
	 * of the search string.
	 * Both Panel and SearchPanel modules are decoupled and can be independently adding into DOM
	 */	
	(function(){
		YAHOO.util.Event.onContentReady("panel", function(){
			YAHOO.donomo.Panel.init();
			
			YAHOO.donomo.SearchPanel.eventSearchStringChanged.subscribe(YAHOO.donomo.Panel.onSeachStringChanged);
			YAHOO.donomo.TagPanel.eventTagSelected.subscribe(YAHOO.donomo.Panel.onTagSelected);
		});
	})();
</script>

<!-- Main panel div -->
<div id="panel" class="db">
</div>


<div id="dlgTagEditor">
	<div class="hd">Please enter tags</div>
	<div class="bd">
		<form><label for="tag">tag:</label><input type="textbox" name="tag" /></form>
	</div>
</div>

<!--
jstemplate templates
-->
<div style='display: none;'>
	<div id='searchresults.template'
		jsselect='pages' 
		jsvars="title: $this.position; page_classes: page line-item ; total_pages:$page_count; doc_id: $this.document" 
		class='panel-item' >
		<div jsvalues="id:$this.url;donomo.tags:tags_string;donomo-doc-id:$this.document" 
			 class="page line-item" >
			<ul class="page-menu">
				<li>
					<a class="view-full-page" 
						jsvalues="id:'view-full-page:' + $this.url;href:'#' + $this.url + '?view_name=jpeg-original'" 
						href="#">
						<img title="Full Size" style='border:none' src='{{MEDIA_URL}}ui/docpanel/assets/page_white.png'/>
					</a>	
				</li>
				<li>
					<a jsvalues="href:$this.url + '?format=application/pdf'" href="#">
						<img title="Download this page as PDF" style='border:none' src='{{MEDIA_URL}}ui/docpanel/assets/page_white_acrobat.png'/>
					</a>	
				</li>
			</ul>
			<img height="60%"  width="100%"  jsvalues=".src:$this.view"/>
			<p><a href="id" 
				jsvalues="href:$this.document" 
				jscontent="'page ' + $this.position">
			</a></p>
		</div>
	</div>


	<div id="document.template" jsselect="documents" class="panel-item" >
		<div jsdisplay="$this.length > 0" jsvalues="donomo.tags:$tags_string;id:$this.url" class="line-item document page page-cover" >
			<p>
				<b><a class="doc-expand" jsvalues="id:'expand:' + $this.url; href: '#' + $this.url" href="#" jscontent="$this.title">title</a></b>
				<span jsdisplay="$this.length > 1"> |  
				<a class="doc-expand" jsvalues="id:'expand:' + $this.url; href: '#' + $this.url" href="#"><span jscontent="$this.length">1</span> pages &raquo;</a>
				</span>
			</p>
			<img height="60%"  width="100%" jsvalues=".src:$this.thumbnail" src="img"/>
			<p>	
				<a jsvalues="href:$this.url + '?format=application/pdf'" href="#">pdf</a> |
				<a class="doc-tag" jsvalues="id:'doc-tag:' + $this.url;" href="#">tags</a> <span jscontent="$this.tags_string"></span>
			</p>
		</div>
		<div 
			jsdisplay="$this.length > 0" 
			jsvalues="id:'join:' + $this.url" 
			class="line-item doc-separator">
		</div>
	</div>

	<div id="page.template" jsselect="document.pages" class="panel-item">
		<div 
			jsvalues="id:$this.url;donomo.tags:tags_string;donomo-doc-id:doc_id;class: 'page line-item '  + ( $index == 0 ? 'page-first ' : '' )  + ($index == total_pages - 1 ? 'page-last ' : '' ) + ( $index > 0 && $index < total_pages-1 ? 'page-middle ' : '');" 
			class="page line-item" 
			donomo-doc-id="parent-doc"
			>
				<ul class="page-menu">
					<li>
						<a class="view-full-page" 
							jsvalues="id:'view-full-page:' + $this.url;href:'#' + $this.url + '?view_name=jpeg-original'" 
							href="#">
							<img title="Full Size" style='border:none' src='{{MEDIA_URL}}ui/docpanel/assets/page_white.png'/>
						</a>	
					</li>
					<li>
						<a jsvalues="href:$this.url + '?format=application/pdf'" href="#">
							<img title="Download this page as PDF" style='border:none' src='{{MEDIA_URL}}ui/docpanel/assets/page_white_acrobat.png'/>
						</a>	
					</li>
					<li jsdisplay="!search_result">
						<a class="doc-collapse" jsvalues="id:'collapse:'; href: '#'" href="#">
							<img src="{{MEDIA_URL}}ui/docpanel/assets/btn-collapse-document.gif" style='border:none' />
						</a>
					</li>				
				</ul>
				<img height="60%"  width="100%"  jsvalues=".src:$this.view"/>
				<p><a href="id" 
					jsvalues="href:$this.url" 
					jscontent="'page ' + $this.position + ' of ' + total_pages">
				</a></p>
				<p jsdisplay="$index == 0">
					<a class="doc-tag" jsvalues="id:'doc-tag:' + doc_id;" href="#">tags</a> <span jscontent="tags_string"></span>
				</p>
		</div>
		<div  jsdisplay="(total_pages - $index) != 1" 
				jsvalues="id:'split:/pages/' + $this.id + '/sep/' + $index + '/' + total_pages" 
				class="line-item page-middle page-separator"></div>
		<div jsdisplay="(total_pages - $index) == 1" 
			jsvalues="id:'join:' + doc_id" 
			class="line-item doc-separator"></div>
	</div>
	
	<!--
	Full page view template.
	Inputs: document json, page_id -- id of the page within a given document that should be shown.
	
	This template scans though the list of pages in the input JSON and sets an <img> element with the
	image url for the given page.
	-->
	<div id="full-view-page.template" class="db" jsselect='document.pages'>
		<img width='100%' jsdisplay='$this.url == page_id' jsvalues=".src:$this.view"/>
	</div>
</div>